import{_ as U,m as F,F as H,q as L,x as n,H as i,t as d,I as M,G as y,B as N,C as m,R as O,S as h,T as q,U as G,D as I,d as c,r as D,w as T,V as j,W as k,X as x,Y as E}from"./index-CiMlwVHq.js";const z=F({name:"ReceiptView",props:{model:{type:Object,default:()=>{}},show:{type:Boolean}},emits:["update:onCancel"],setup(a,{emit:t}){const g=j.description,{$q:u,$date:p}=I(),o=c(()=>a.model),s=D(!1),R=c(()=>!o.value||!Array.isArray(o.value.items)?0:o.value.items.reduce((e,r)=>e+r.sub_total,0)),V=c(()=>p.formatDate(Date.now(),"DD/MM/YYYY HH:mm")),Y=e=>e?p.formatDate(e,"DD/MM/YYYY"):"-",_=e=>e?.toLocaleString(),P=c(()=>o.value?.code??o.value?.name??o.value?.id),v=D(null);let l=null;const $=async()=>{k.show({group:"receipt",message:"Generating PDF...",spinnerSize:"4em",backgroundColor:"rgba(0,0,0,0.4)"});try{const e=v.value;if(!e)return;const r=await x(e,{useCORS:!0,allowTaint:!1,backgroundColor:"#ffffff",scale:window.devicePixelRatio>1?2:1}),B=r.toDataURL("image/png"),f=58,w=r.height*f/r.width,C=new E({unit:"mm",format:[f,w]});C.addImage(B,"PNG",0,0,f,w),l=C;const b=u.dialog({dark:!0,title:"PDF Ready",message:"Choose action",options:{type:"radio",model:"preview",items:[{label:"Preview",value:"preview"},{label:"Download",value:"download"}]},ok:{label:"Apply",color:"primary"},cancel:{label:"Close",color:"negative"},persistent:!0});b.onOk(S=>{if(l){if(S==="preview"){const A=l.output("blob"),Q=URL.createObjectURL(A);window.open(Q,"_blank")}else l.save("vue-test.pdf");t("update:onCancel",!1)}}),b.onCancel(()=>{l=null,t("update:onCancel",!1)})}catch(e){return u.notify({type:"info",color:"negative",message:e.message||e,progress:!0,timeout:3e3})}finally{k.hide("receipt")}};return T(()=>a.show,e=>s.value=e),{product:g,data:o,dialog:s,total:R,now:V,formatDate:Y,n:_,caption:P,view:v,instance:l,makePdf:$}}}),W={class:"hide-canvas"},X={ref:"view",class:"pdf-box"};function J(a,t,g,u,p,o){return L(),H(G,null,[n(q,{modelValue:a.dialog,"onUpdate:modelValue":t[1]||(t[1]=s=>a.dialog=s),persistent:""},{default:d(()=>[n(M,{dark:""},{default:d(()=>[n(y,null,{default:d(()=>[...t[2]||(t[2]=[i("div",{class:"text-h6"},"Confirmation",-1)])]),_:1}),n(y,{class:"q-pt-none"},{default:d(()=>[N(" Are your print "+m(a.caption)+"? ",1)]),_:1}),n(O,{align:"right"},{default:d(()=>[n(h,{label:"cancel",color:"negative",onClick:t[0]||(t[0]=s=>a.$emit("update:onCancel",!1))}),n(h,{label:"sure",color:"primary",onClick:a.makePdf},null,8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),i("div",W,[i("div",X,[i("h4",null,m(a.product),1),i("p",null,"Date: "+m(a.now),1)],512)])],64)}const Z=U(z,[["render",J],["__scopeId","data-v-347d41e4"]]);export{Z as default};
