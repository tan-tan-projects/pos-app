import{_ as V,m as k,R as $,p as h,q as _,t as n,x as o,I as B,G as d,H as P,B as Q,C as S,S as b,T as g,U as q,V as N,D as A,r as y,d as D,w as U}from"./index-CzyjqKPk.js";const x=k({name:"CanvasView",components:{ViewPage:N},props:{model:{type:Object,default:()=>{}},storename:{type:String},show:{type:Boolean}},emits:["update:onCancel"],setup(e,{emit:a}){const{$q:s,$router:c,$store:m,$crypto:p}=A(),r=y(!1),l=y(null),w=async()=>{const i=s.platform.is.ios||s.platform.is.safari;let u,f;if(i)try{u=await m.load("key"),f=await p.encrypt(e.model,u)}catch(t){return s.notify({type:"info",color:"negative",message:t.message||t,progress:!0,timeout:3e3})}try{const t=l.value;if(!t)throw new Error("Failed to process pdf");if(i){const v=c.resolve({path:`/download/receipt/${e.storename}`,query:{data:encodeURIComponent(JSON.stringify(f))}});window.open(v.href,"_blank")}else return await t.print()}catch(t){return s.notify({type:"info",color:"negative",message:t.message||t,progress:!0,timeout:3e3})}finally{a("update:onCancel",!1)}},C=D(()=>e.model?.code??e.model?.name??e.model?.id);return U(()=>e.show,i=>r.value=i),{dialog:r,view:l,makePdf:w,caption:C}}});function H(e,a,s,c,m,p){const r=$("ViewPage");return _(),h(q,{modelValue:e.dialog,"onUpdate:modelValue":a[1]||(a[1]=l=>e.dialog=l),persistent:""},{default:n(()=>[o(B,{dark:""},{default:n(()=>[o(d,null,{default:n(()=>[...a[2]||(a[2]=[P("div",{class:"text-h6"},"Confirmation",-1)])]),_:1}),o(d,{style:{"max-height":"50vh"},class:"scroll"},{default:n(()=>[o(r,{ref:"view",model:e.model},null,8,["model"])]),_:1}),o(d,{class:"q-pt-none"},{default:n(()=>[Q(" Are your print "+S(e.caption)+"? ",1)]),_:1}),o(b,{align:"right"},{default:n(()=>[o(g,{label:"cancel",color:"negative",onClick:a[0]||(a[0]=l=>e.$emit("update:onCancel",!1))}),o(g,{label:"sure",color:"primary",onClick:e.makePdf},null,8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])}const O=V(x,[["render",H]]);export{O as default};
