import{a as ve,u as ye,g as ke,b as be,r as B,o as ge,d as m,w as D,h as v,n as ae,e as xe,Q as _e,f as J,i as Se,j as te,k as Ce,v as qe,l as le,_ as Te,m as Ke,p as me,q as Ne,t as Q,x as L,y as Ae,z as ne,A as we,B as Ee,C as Pe,D as $e,E as Be}from"./index-oAdzayMT.js";import{Q as ze}from"./QSlideTransition-C6wAwPLY.js";const Fe=["none","strict","leaf","leaf-filtered"],Qe=ve({name:"QTree",props:{...ye,nodes:{type:Array,required:!0},nodeKey:{type:String,required:!0},labelKey:{type:String,default:"label"},childrenKey:{type:String,default:"children"},dense:Boolean,color:String,controlColor:String,textColor:String,selectedColor:String,icon:String,tickStrategy:{type:String,default:"none",validator:l=>Fe.includes(l)},ticked:Array,expanded:Array,selected:{},noSelectionUnset:Boolean,defaultExpandAll:Boolean,accordion:Boolean,filter:String,filterMethod:Function,duration:{},noConnectors:Boolean,noTransition:Boolean,noNodesLabel:String,noResultsLabel:String},emits:["update:expanded","update:ticked","update:selected","lazyLoad","afterShow","afterHide"],setup(l,{slots:b,emit:x}){const{proxy:K}=ke(),{$q:g}=K,_=be(l,g),k=B({}),C=B(l.ticked||[]),q=B(l.expanded||[]);let N={};ge(()=>{N={}});const R=m(()=>`q-tree q-tree--${l.dense===!0?"dense":"standard"}`+(l.noConnectors===!0?" q-tree--no-connectors":"")+(_.value===!0?" q-tree--dark":"")+(l.color!==void 0?` text-${l.color}`:"")),z=m(()=>l.selected!==void 0),M=m(()=>l.icon||g.iconSet.tree.icon),I=m(()=>l.controlColor||l.color),A=m(()=>l.textColor!==void 0?` text-${l.textColor}`:""),r=m(()=>{const t=l.selectedColor||l.color;return t?` text-${t}`:""}),u=m(()=>l.filterMethod!==void 0?l.filterMethod:(t,n)=>{const e=n.toLowerCase();return t[l.labelKey]&&t[l.labelKey].toLowerCase().indexOf(e)!==-1}),c=m(()=>{const t={},n=(e,i)=>{const a=e.tickStrategy||(i?i.tickStrategy:l.tickStrategy),o=e[l.nodeKey],s=e[l.childrenKey]&&Array.isArray(e[l.childrenKey])&&e[l.childrenKey].length!==0,P=e.disabled!==!0&&z.value===!0&&e.selectable!==!1,y=e.disabled!==!0&&e.expandable!==!1,fe=a!=="none",U=a==="strict",p=a==="leaf-filtered",V=a==="leaf"||a==="leaf-filtered";let G=e.disabled!==!0&&e.tickable!==!1;V===!0&&G===!0&&i&&i.tickable!==!0&&(G=!1);let $=e.lazy;$===!0&&k.value[o]!==void 0&&Array.isArray(e[l.childrenKey])===!0&&($=k.value[o]);const d={key:o,parent:i,isParent:s,lazy:$,disabled:e.disabled,link:e.disabled!==!0&&(P===!0||y===!0&&(s===!0||$===!0)),children:[],matchesFilter:l.filter?u.value(e,l.filter):!0,selected:o===l.selected&&P===!0,selectable:P,expanded:s===!0?q.value.includes(o):!1,expandable:y,noTick:e.noTick===!0||U!==!0&&$&&$!=="loaded",tickable:G,tickStrategy:a,hasTicking:fe,strictTicking:U,leafFilteredTicking:p,leafTicking:V,ticked:U===!0?C.value.includes(o):s===!0?!1:C.value.includes(o)};if(t[o]=d,s===!0&&(d.children=e[l.childrenKey].map(h=>n(h,d)),l.filter&&(d.matchesFilter!==!0?d.matchesFilter=d.children.some(h=>h.matchesFilter):d.noTick!==!0&&d.disabled!==!0&&d.tickable===!0&&p===!0&&d.children.every(h=>h.matchesFilter!==!0||h.noTick===!0||h.tickable!==!0)===!0&&(d.tickable=!1)),d.matchesFilter===!0&&(d.noTick!==!0&&U!==!0&&d.children.every(h=>h.noTick)===!0&&(d.noTick=!0),V))){if(d.ticked=!1,d.indeterminate=d.children.some(h=>h.indeterminate===!0),d.tickable=d.tickable===!0&&d.children.some(h=>h.tickable),d.indeterminate!==!0){const h=d.children.reduce((ee,he)=>he.ticked===!0?ee+1:ee,0);h===d.children.length?d.ticked=!0:h>0&&(d.indeterminate=!0)}d.indeterminate===!0&&(d.indeterminateNextState=d.children.every(h=>h.tickable!==!0||h.ticked!==!0))}return d};return l.nodes.forEach(e=>n(e,null)),t});D(()=>l.ticked,t=>{C.value=t}),D(()=>l.expanded,t=>{q.value=t});function f(t){const n=[].reduce,e=(i,a)=>{if(i||!a)return i;if(Array.isArray(a)===!0)return n.call(Object(a),e,i);if(a[l.nodeKey]===t)return a;if(a[l.childrenKey])return e(null,a[l.childrenKey])};return e(null,l.nodes)}function S(){return C.value.map(t=>f(t))}function T(){return q.value.map(t=>f(t))}function j(t){return t&&c.value[t]?c.value[t].expanded:!1}function w(){l.expanded!==void 0?x("update:expanded",[]):q.value=[]}function F(){const t=[],n=e=>{e[l.childrenKey]&&e[l.childrenKey].length!==0&&e.expandable!==!1&&e.disabled!==!0&&(t.push(e[l.nodeKey]),e[l.childrenKey].forEach(n))};l.nodes.forEach(n),l.expanded!==void 0?x("update:expanded",t):q.value=t}function E(t,n,e=f(t),i=c.value[t]){if(i.lazy&&i.lazy!=="loaded"){if(i.lazy==="loading")return;k.value[t]="loading",Array.isArray(e[l.childrenKey])!==!0&&(e[l.childrenKey]=[]),x("lazyLoad",{node:e,key:t,done:a=>{k.value[t]="loaded",e[l.childrenKey]=Array.isArray(a)===!0?a:[],ae(()=>{c.value[t]?.isParent===!0&&W(t,!0)})},fail:()=>{delete k.value[t],e[l.childrenKey].length===0&&delete e[l.childrenKey]}})}else i.isParent===!0&&i.expandable===!0&&W(t,n)}function W(t,n){let e=q.value;const i=l.expanded!==void 0;if(i===!0&&(e=e.slice()),n){if(l.accordion&&c.value[t]){const a=[];c.value[t].parent?c.value[t].parent.children.forEach(o=>{o.key!==t&&o.expandable===!0&&a.push(o.key)}):l.nodes.forEach(o=>{const s=o[l.nodeKey];s!==t&&a.push(s)}),a.length!==0&&(e=e.filter(o=>a.includes(o)===!1))}e=e.concat([t]).filter((a,o,s)=>s.indexOf(a)===o)}else e=e.filter(a=>a!==t);i===!0?x("update:expanded",e):q.value=e}function ie(t){return t&&c.value[t]?c.value[t].ticked:!1}function O(t,n){let e=C.value;const i=l.ticked!==void 0;i===!0&&(e=e.slice()),n?e=e.concat(t).filter((a,o,s)=>s.indexOf(a)===o):e=e.filter(a=>t.includes(a)===!1),i===!0&&x("update:ticked",e)}function re(t,n,e){const i={tree:K,node:t,key:e,color:l.color,dark:_.value};return le(i,"expanded",()=>n.expanded,a=>{a!==n.expanded&&E(e,a)}),le(i,"ticked",()=>n.ticked,a=>{a!==n.ticked&&O([e],a)}),i}function X(t){return(l.filter?t.filter(n=>c.value[n[l.nodeKey]].matchesFilter):t).map(n=>oe(n))}function ce(t){if(t.icon!==void 0)return v(J,{class:"q-tree__icon q-mr-sm",name:t.icon,color:t.iconColor});const n=t.img||t.avatar;if(n)return v("img",{class:`q-tree__${t.img?"img":"avatar"} q-mr-sm`,src:n})}function de(){x("afterShow")}function ue(){x("afterHide")}function oe(t){const n=t[l.nodeKey],e=c.value[n],i=t.header&&b[`header-${t.header}`]||b["default-header"],a=e.isParent===!0?X(t[l.childrenKey]):[],o=a.length!==0||e.lazy&&e.lazy!=="loaded";let s=t.body&&b[`body-${t.body}`]||b["default-body"];const P=i!==void 0||s!==void 0?re(t,e,n):null;return s!==void 0&&(s=v("div",{class:"q-tree__node-body relative-position"},[v("div",{class:A.value},[s(P)])])),v("div",{key:n,class:`q-tree__node relative-position q-tree__node--${o===!0?"parent":"child"}`},[v("div",{class:"q-tree__node-header relative-position row no-wrap items-center"+(e.link===!0?" q-tree__node--link q-hoverable q-focusable":"")+(e.selected===!0?" q-tree__node--selected":"")+(e.disabled===!0?" q-tree__node--disabled":""),tabindex:e.link===!0?0:-1,ariaExpanded:a.length>0?e.expanded:null,role:"treeitem",onClick:y=>{Z(t,e,y)},onKeypress(y){xe(y)!==!0&&(y.keyCode===13?Z(t,e,y,!0):y.keyCode===32&&H(t,e,y,!0))}},[v("div",{class:"q-focus-helper",tabindex:-1,ref:y=>{N[e.key]=y}}),e.lazy==="loading"?v(_e,{class:"q-tree__spinner",color:I.value}):o===!0?v(J,{class:"q-tree__arrow"+(e.expanded===!0?" q-tree__arrow--rotate":""),name:M.value,onClick(y){H(t,e,y)}}):null,e.hasTicking===!0&&e.noTick!==!0?v(Se,{class:"q-tree__tickbox",modelValue:e.indeterminate===!0?null:e.ticked,color:I.value,dark:_.value,dense:!0,keepColor:!0,disable:e.tickable!==!0,onKeydown:te,"onUpdate:modelValue":y=>{se(e,y)}}):null,v("div",{class:"q-tree__node-header-content col row no-wrap items-center"+(e.selected===!0?r.value:A.value)},[i?i(P):[ce(t),v("div",t[l.labelKey])]])]),o===!0?l.noTransition===!0?e.expanded===!0?v("div",{class:"q-tree__node-collapsible"+A.value,key:`${n}__q`},[s,v("div",{class:"q-tree__children"+(e.disabled===!0?" q-tree__node--disabled":""),role:"group"},a)]):null:v(ze,{duration:l.duration,onShow:de,onHide:ue},()=>Ce(v("div",{class:"q-tree__node-collapsible"+A.value,key:`${n}__q`},[s,v("div",{class:"q-tree__children"+(e.disabled===!0?" q-tree__node--disabled":""),role:"group"},a)]),[[qe,e.expanded]])):s])}function Y(t){N[t]?.focus()}function Z(t,n,e,i){i!==!0&&n.selectable!==!1&&Y(n.key),z.value&&n.selectable?l.noSelectionUnset===!1?x("update:selected",n.key!==l.selected?n.key:null):n.key!==l.selected&&x("update:selected",n.key===void 0?null:n.key):H(t,n,e,i),typeof t.handler=="function"&&t.handler(t)}function H(t,n,e,i){e!==void 0&&te(e),i!==!0&&n.selectable!==!1&&Y(n.key),E(n.key,!n.expanded,t,n)}function se(t,n){if(t.indeterminate===!0&&(n=t.indeterminateNextState),t.strictTicking)O([t.key],n);else if(t.leafTicking){const e=[],i=a=>{a.isParent?(n!==!0&&a.noTick!==!0&&a.tickable===!0&&e.push(a.key),a.leafTicking===!0&&a.children.forEach(i)):a.noTick!==!0&&a.tickable===!0&&(a.leafFilteredTicking!==!0||a.matchesFilter===!0)&&e.push(a.key)};i(t),O(e,n)}}return l.defaultExpandAll===!0&&F(),Object.assign(K,{getNodeByKey:f,getTickedNodes:S,getExpandedNodes:T,isExpanded:j,collapseAll:w,expandAll:F,setExpanded:E,isTicked:ie,setTicked:O}),()=>{const t=X(l.nodes);return v("div",{class:R.value,role:"tree"},t.length===0?l.filter?l.noResultsLabel||g.lang.tree.noResults:l.noNodesLabel||g.lang.tree.noNodes:t)}}}),Le=Ke({name:"SideMenu",props:{menu:{type:Array,default:()=>[]}},setup(l){const{$route:b,$router:x}=$e(),K=B(null),g=B([]),_=B([]),k=async r=>await Be(r),C=async r=>{if(!r||!r.length)return[];const u=[];for(const c of r){if(!(!c.roles||await k(c.roles)))continue;let S={...c};c.children&&(S.children=await C(c.children)),u.push(S)}return u},q=(r,u)=>{for(const c of r){if(c.label===u)return c;if(c.children){const f=q(c.children,u);if(f)return f}}return null},N=(r,u,c=[])=>{for(const f of r){const S=[...c,f.label];if(f.label===u)return S;if(f.children){const T=N(f.children,u,S);if(T.length)return T}}return[]},R=async r=>{await ae();const u=q(_.value,r);u&&u.path&&(g.value=N(_.value,r),x.push(u.path))},z=()=>{const r=b.path,u=M(_.value,r);u.length&&(g.value=u.slice(0,-1),K.value=u[u.length-1])},M=(r,u,c=[])=>{for(const f of r){const S=[...c,f.label];if(f.path===u)return S;if(f.children){const T=M(f.children,u,S);if(T.length)return T}}return[]},I=(r,u)=>{const c=(S,T,j=[])=>{for(const w of S){const F=[...j,w.label];if(w.label===T)return F;if(w.children){const E=c(w.children,T,F);if(E.length)return E}}return[]};return c(_.value,u).includes(r)&&r!==u},A=r=>{if(r.path)g.value=N(_.value,r.label),K.value=r.label,x.push(r.path);else if(r.children?.length){const u=g.value.includes(r.label);g.value=u?g.value.filter(c=>c!==r.label):[...g.value.filter(c=>c===r.label||I(c,r.label)),r.label]}};return D(()=>l.menu,async r=>{_.value=r&&r.length?await C(r):[],z()},{deep:!0,immediate:!0}),D(()=>b.path,()=>{z()},{immediate:!0}),{selectedNode:K,expandedNode:g,filteredMenu:_,filterMenu:C,onNodeSelected:R,onNodeClicked:A}}});function Me(l,b,x,K,g,_){return Ne(),me(Qe,{accordion:"","node-key":"label",nodes:l.filteredMenu,"tick-strategy":"none",selected:l.selectedNode,"onUpdate:selected":[b[0]||(b[0]=k=>l.selectedNode=k),l.onNodeSelected],expanded:l.expandedNode,"onUpdate:expanded":b[1]||(b[1]=k=>l.expandedNode=k)},{"default-header":Q(k=>[L(Ae,{dense:"",clickable:"",onClick:C=>l.onNodeClicked(k.node),class:"custom-item"},{default:Q(()=>[L(ne,{avatar:""},{default:Q(()=>[L(J,{name:k.node.icon||"folder",color:"black"},null,8,["name"])]),_:2},1024),L(ne,null,{default:Q(()=>[L(we,{class:"menu-label"},{default:Q(()=>[Ee(Pe(k.node.label),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])]),_:1},8,["nodes","selected","expanded","onUpdate:selected"])}const Ue=Te(Le,[["render",Me],["__scopeId","data-v-977ec259"]]);export{Ue as default};
