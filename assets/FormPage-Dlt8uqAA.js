import{_ as E,m as T,a1 as V,p as v,q as y,t as u,x as i,a2 as z,G as w,H as C,f as Q,C as _,I as F,R as q,a3 as D,T as b,a4 as j,a5 as L,D as N,a6 as O,r as $,d as H,L as P,E as R,n as U,a7 as G}from"./index-fnm8zYBb.js";const M=T({name:"FormPage",components:{BaseCard:L},props:{api:{type:Boolean},path:{type:String,required:!0,default:void 0},id:{type:String,required:!1},title:{type:String,required:!0,default:"Default Form"},icon:{type:String,required:!0,default:"note"},hasItems:{type:Boolean},formDialog:{type:Boolean,default:!1}},emits:["close"],setup(e,{emit:s}){const{$q:o,$router:c,$route:k}=N(),f=O({api:e.api,storename:e.path}),m=e.formDialog?e.id?e.id:"new":k.params.id,l=$(null),d=$(!1),t=$({}),p=$(!1),B=H(()=>"status"in t.value&&t.value.status==="Draft"||"level"in t.value&&t.value.level===0?!0:!!p.value),I=async a=>{if(await U(),a==="edit"){("status"in t.value&&t.value.status==="Draft"||"level"in t.value&&t.value.level===0)&&(d.value=!1),p.value&&(d.value=!1);return}else{if(a==="close")return h(a);const n=l.value;if(!await l.value.validate()){const r=n.$el.querySelector(".q-field--error input, .q-field--error .q-select__control"),A=r?.closest(".q-field")?.querySelector(".q-field__label")?.innerText||"Some field";return r?.focus&&(r.focus(),e.formDialog||r.scrollIntoView({behavior:"smooth",block:"center"})),o.notify({type:"info",message:`${A} is required`,color:"negative",timeout:3e3,progress:!0})}if(e.hasItems){const r=t.value?.items;if(!r||Array.isArray(r)&&r.length===0){const g=document.getElementById("items-section");return g&&(g.scrollIntoView({behavior:"smooth",block:"center"}),g.focus?.()),o.notify({type:"info",message:"items is required",color:"negative",timeout:3e3,progress:!0})}}return h(a)}},h=async a=>{switch(a){case"save":try{return console.log(`--[Saving data] page: ${e.title}--`),await f.create({id:G(),...t.value}).then(()=>{o.notify({type:"check_circle",color:"positive",message:`${e.title} ${a} has been successfully`,progress:!0,timeout:2500}),setTimeout(()=>e.formDialog?s("close",!1):c.back(),500)})}catch(n){return o.notify({type:"negative",message:n.message||`${e.title} failed ${a}`,progress:!0,timeout:3e3})}case"update":try{return console.log(`--[Updating data] page: ${e.title}--`),await f.update(t.value.id,t.value).then(()=>{o.notify({type:"check_circle",color:"positive",message:`${e.title} ${a} has been successfully`,progress:!0,timeout:2500}),console.log(e.formDialog),setTimeout(()=>e.formDialog?s("close",!1):c.back(),500)})}catch(n){return o.notify({type:"negative",message:n.message||`${e.title} failed ${a}`,progress:!0,timeout:3e3})}case"close":return console.log(`--[Closing] page: ${e.title}--`),e.formDialog?s("close",!1):c.back();default:return o.notify({type:"info",color:"negative",message:`Action ${String(a).toLowerCase} not found`,progress:!0,timeout:3e3})}};return P(async()=>{if(p.value=await R("admin"),m!=="new"){console.log("LOAD DATA >>>>>>>>>>>>>>>>>");try{const a=await f.findOne(m);for(const[n,S]of Object.entries(a))t.value[n]=S;console.log(t.value)}catch(a){return a}finally{d.value=!0}}}),{form:l,edit:d,model:t,canEdit:B,preSubmit:I,onSubmit:h}}}),J={class:"row items-center justify-center q-gutter-sm q-mb-xs header-row"},K={class:"text-h6 text-weight-medium"};function W(e,s,o,c,k,f){const m=V("base-card");return y(),v(m,null,{default:u(()=>[i(z,{ref:"form"},{default:u(()=>[i(w,{class:"no-padding q-my-xs"},{default:u(()=>[C("div",J,[i(Q,{name:e.icon,size:e.$q.screen.name},null,8,["name","size"]),C("h3",K,"Add "+_(e.title),1)]),i(F,{flat:"",bordered:"",class:"nav-bar glasses-background white-border shadow-2"},{default:u(()=>[i(w,{class:"row items-center q-gutter-sm q-pa-sm justify-center action-row"},{default:u(()=>[e.canEdit&&e.edit?(y(),v(b,{key:0,dense:"",size:"md",icon:"edit",color:"warning",label:"Edit",flat:"",onClick:s[0]||(s[0]=l=>e.preSubmit("edit"))})):q("",!0),!e.model.id&&!e.edit?(y(),v(b,{key:1,dense:"",size:"md",icon:"add",color:"positive",label:"Save",flat:"",onClick:s[1]||(s[1]=l=>e.preSubmit("save"))})):q("",!0),e.model.id&&!e.edit?(y(),v(b,{key:2,dense:"",size:"md",icon:"save",color:"primary",label:"Update",flat:"",onClick:s[2]||(s[2]=l=>e.preSubmit("update"))})):q("",!0),i(b,{dense:"",size:"md",icon:"close",color:"negative",label:"Close",flat:"",onClick:s[3]||(s[3]=l=>e.preSubmit("close"))}),D(e.$slots,"action",{model:e.form},void 0,!0)]),_:3})]),_:3})]),_:3}),i(j,{name:"fade"},{default:u(()=>[i(w,{bordered:"",class:"scroll white-border"},{default:u(()=>[D(e.$slots,"body",{model:e.model,edit:e.edit},void 0,!0)]),_:3})]),_:3})]),_:3},512)]),_:3})}const Y=E(M,[["render",W],["__scopeId","data-v-fd2b4751"]]);export{Y as default};
