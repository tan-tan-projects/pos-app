import{_ as U,m as F,F as H,q as L,x as n,H as i,t as d,I as M,G as y,B as N,C as m,R as O,S as h,T,U as q,D as x,d as c,r as k,w as G,V as I,W as D,n as j,X as E,Y as z}from"./index-BAFMXeEF.js";const W=F({name:"ReceiptView",props:{model:{type:Object,default:()=>{}},show:{type:Boolean}},emits:["update:onCancel"],setup(a,{emit:t}){const g=I.description,{$q:u,$date:p}=x(),o=c(()=>a.model),l=k(!1),R=c(()=>!o.value||!Array.isArray(o.value.items)?0:o.value.items.reduce((e,r)=>e+r.sub_total,0)),V=c(()=>p.formatDate(Date.now(),"DD/MM/YYYY HH:mm")),Y=e=>e?p.formatDate(e,"DD/MM/YYYY"):"-",_=e=>e?.toLocaleString(),P=c(()=>o.value?.code??o.value?.name??o.value?.id),v=k(null);let s=null;const $=async()=>{D.show({group:"receipt",message:"Generating PDF...",spinnerSize:"4em",backgroundColor:"rgba(0,0,0,0.4)"});try{await j();const e=v.value;if(!e)return;const r=await E(e,{useCORS:!0,allowTaint:!1,backgroundColor:"#ffffff",scale:window.devicePixelRatio>1?2:1}),B=r.toDataURL("image/png"),f=58,w=r.height*f/r.width,C=new z({unit:"mm",format:[f,w]});C.addImage(B,"PNG",0,0,f,w),s=C;const b=u.dialog({dark:!0,title:"PDF Ready",message:"Choose action",options:{type:"radio",model:"preview",items:[{label:"Preview",value:"preview"},{label:"Download",value:"download"}]},ok:{label:"Apply",color:"primary"},cancel:{label:"Close",color:"negative"},persistent:!0});b.onOk(S=>{if(s){if(S==="preview"){const A=s.output("blob"),Q=URL.createObjectURL(A);window.open(Q,"_blank")}else s.save("vue-test.pdf");t("update:onCancel",!1)}}),b.onCancel(()=>{s=null,t("update:onCancel",!1)})}catch(e){return u.notify({type:"info",color:"negative",message:e.message||e,progress:!0,timeout:3e3})}finally{D.hide("receipt")}};return G(()=>a.show,e=>l.value=e),{product:g,data:o,dialog:l,total:R,now:V,formatDate:Y,n:_,caption:P,view:v,instance:s,makePdf:$}}}),X={class:"hide-canvas"},J={ref:"view",class:"pdf-box"};function K(a,t,g,u,p,o){return L(),H(q,null,[n(T,{modelValue:a.dialog,"onUpdate:modelValue":t[1]||(t[1]=l=>a.dialog=l),persistent:""},{default:d(()=>[n(M,{dark:""},{default:d(()=>[n(y,null,{default:d(()=>[...t[2]||(t[2]=[i("div",{class:"text-h6"},"Confirmation",-1)])]),_:1}),n(y,{class:"q-pt-none"},{default:d(()=>[N(" Are your print "+m(a.caption)+"? ",1)]),_:1}),n(O,{align:"right"},{default:d(()=>[n(h,{label:"cancel",color:"negative",onClick:t[0]||(t[0]=l=>a.$emit("update:onCancel",!1))}),n(h,{label:"sure",color:"primary",onClick:a.makePdf},null,8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),i("div",X,[i("div",J,[i("h4",null,m(a.product),1),i("p",null,"Date: "+m(a.now),1)],512)])],64)}const ee=U(W,[["render",K],["__scopeId","data-v-378b65a0"]]);export{ee as default};
