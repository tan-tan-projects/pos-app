import{_ as k,m as V,R as $,F as S,q as g,x as o,p as P,X as D,t as l,I as h,G as y,H as U,B as b,C as B,S as Q,k as N,T as w,a8 as T,U as q,a4 as A,a9 as F,aa as _,D as R,r as p,ab as E}from"./index-DeYsl4Op.js";const H=V({name:"CanvasView",components:{ViewPage:_},props:{storename:{type:String,default:void 0},position:{type:String,default:"portrait"},title:{type:String,default:"Default Tilte"},subtitle:{type:String,default:"Default Subtitle"},filter:{type:Object,default:()=>{}},colMain:{type:Array,default:()=>[]}},emits:["update:model"],setup(e,{emit:a}){const{$q:s,$router:d,$store:u,$crypto:m}=R(),r=p(!1),n=p(1),c=p(null),f=async()=>{try{r.value=!1,s.loading.show({group:"print",spinner:E,spinnerSize:"5em",message:"Preparing document...",progress:!0}),await new Promise(i=>setTimeout(i,50));const t=c.value;if(!t)throw new Error("Failed to process pdf");if(s.platform.is.ios||s.platform.is.safari){const i=await u.load("key"),v=await m.encrypt(e,i),C=d.resolve({path:`/download/document/${e.storename}`,query:{data:encodeURIComponent(JSON.stringify(v))}});window.open(C.href,"_blank")}else return await t.print()}catch(t){return s.notify({type:"info",color:"negative",message:t.message||t,progress:!0,timeout:3e3})}finally{a("update:model",{})}};return{pages:n,dialog:r,view:c,makePdf:f,onUpdate:async t=>{if(n.value=t,n.value>5)r.value=!0;else return await f()}}}});function I(e,a,s,d,u,m){const r=$("ViewPage");return g(),S(F,null,[o(q,{modelValue:e.dialog,"onUpdate:modelValue":a[1]||(a[1]=n=>e.dialog=n),persistent:""},{default:l(()=>[o(h,{dark:""},{default:l(()=>[o(y,null,{default:l(()=>[...a[2]||(a[2]=[U("div",{class:"text-h6"},"Confirmation",-1)])]),_:1}),o(y,{class:"q-pt-none"},{default:l(()=>[b(" The PDF has "+B(e.pages)+" pages. Rendering may take a while. Do you want to continue? ",1)]),_:1}),o(Q,{align:"right"},{default:l(()=>[N(o(w,{label:"cancel",color:"negative",onClick:a[0]||(a[0]=n=>e.$emit("update:model",{}))},null,512),[[T]]),o(w,{label:"sure",color:"primary",onClick:e.makePdf},null,8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e.storename?(g(),P(r,A({key:0,ref:"view",class:"hide-canvas"},e.$props,{"onUpdate:pages":e.onUpdate}),null,16,["onUpdate:pages"])):D("",!0)],64)}const G=k(H,[["render",I]]);export{G as default};
